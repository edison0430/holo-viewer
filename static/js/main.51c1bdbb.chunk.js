(this["webpackJsonpholo-viewer"]=this["webpackJsonpholo-viewer"]||[]).push([[0],{49:function(e,t,r){},75:function(e,t,r){"use strict";r.r(t);var n=r(0),c=r.n(n),a=r(18),s=r.n(a),i=r(3),o=r(13),l=r(36),d=(r(49),r(11)),u=r(2),j=r(21),b=r(14),m=r(1);var f=function(e){var t=e.open,r=e.toggle,c=Object(n.useRef)(null);return Object(n.useEffect)((function(){var e=function(e){if(!c.current.contains(e.target)){if(!t)return;r()}};return window.addEventListener("click",e),function(){return window.removeEventListener("click",e)}}),[t,r]),Object(m.jsxs)("aside",{ref:c,className:"fixed top-0 left-0 h-screen w-56 ".concat(!t&&"-translate-x-full"," bg-white z-10 transform duration-200"),children:[Object(m.jsxs)("div",{className:"h-14 pl-4 mb-2 flex items-center space-x-4",children:[Object(m.jsx)("button",{onClick:r,className:"w-6 h-6",children:Object(m.jsx)(b.b,{})}),Object(m.jsx)("div",{className:"text-xl tracking-wide font-bold",children:"Holo Viewer"})]}),Object(m.jsxs)("nav",{children:[Object(m.jsxs)(d.b,{to:"/",exact:!0,className:"py-2 px-4 flex items-center space-x-4 hover:bg-gray-100",activeClassName:"bg-gray-200",onClick:r,children:[Object(m.jsx)(b.a,{className:"h-6 w-6"}),Object(m.jsx)("span",{children:"\u9996\u9801"})]}),Object(m.jsxs)(d.b,{to:"/multi-view",exact:!0,className:"py-2 px-4 flex items-center space-x-4 hover:bg-gray-100",activeClassName:"bg-gray-200",onClick:r,children:[Object(m.jsx)(b.c,{className:"h-6 w-6"}),Object(m.jsx)("span",{children:"\u591a\u7a97\u95b1\u89bd"})]})]})]})},h=r(10),x=r.n(h),O=r(4),v=r(17),g="FETCH_LIVE_STREAM",p="FETCH_SCHEDULED_STREAM",w="FETCH_CHANNEL",N="FETCH_MEMBER",y="ADD_STREAM_TO_MULTI_VIEW",_="REMOVE_STREAM_FROM_MULTI_VIEW",E=r(38),S=r.n(E).a.create({baseURL:"https://holo.dev/api/v1"}),k=function(){return function(){var e=Object(v.a)(x.a.mark((function e(t){var r,n;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.get("/lives/current");case 2:r=e.sent,n=r.data.lives.map((function(e){return Object(O.a)(Object(O.a)({},e),{},{status:"live"})})),t({type:g,payload:n});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},R=function(){return function(){var e=Object(v.a)(x.a.mark((function e(t){var r,n;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.get("/lives/scheduled");case 2:r=e.sent,n=r.data.lives.map((function(e){return Object(O.a)(Object(O.a)({},e),{},{status:"scheduled"})})),t({type:p,payload:n});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},T=function(){return function(){var e=Object(v.a)(x.a.mark((function e(t){var r,n,c,a;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(r=JSON.parse(sessionStorage.getItem("channel"))||[]).length){e.next=13;break}n=1,c=!0;case 4:if(!c){e.next=12;break}return e.next=7,S.get("channels?limit=100&page=".concat(n));case 7:a=e.sent,(r=r.concat(a.data.channels)).length<a.data.total?n++:c=!1,e.next=4;break;case 12:sessionStorage.setItem("channel",JSON.stringify(r));case 13:t({type:w,payload:r});case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},C=function(){return function(){var e=Object(v.a)(x.a.mark((function e(t){var r,n;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(r=JSON.parse(sessionStorage.getItem("member"))||[]).length){e.next=7;break}return e.next=4,S.get("/members");case 4:n=e.sent,r=n.data,sessionStorage.setItem("member",JSON.stringify(r));case 7:t({type:N,payload:r});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()};var I=function(){var e=Object(i.b)(),t=Object(i.c)((function(e){return e.streamReducer.liveStream})),r=Object(i.c)((function(e){return e.streamReducer.channel})),c=Object(i.c)((function(e){return e.streamReducer.member})),a=Object(i.c)((function(e){return e.multiViewReducer}));Object(n.useEffect)((function(){e(k()),e(R()),e(T()),e(C())}),[e]);var s=function(t){var r;a.some((function(e){return e.id===t.id}))?e((r=t.id,{type:_,payload:r})):e(function(e){return{type:y,payload:e}}(t))},o=t.map((function(e){var t,n=null===(t=r.find((function(t){return t.id===e.channel_id})))||void 0===t?void 0:t.member_id,i=c.find((function(e){return e.id===n}));return Object(m.jsx)("button",{className:"rounded-full  ".concat(a.some((function(t){return t.id===e.id}))&&"ring-4 ring-red-500"),onClick:function(){return s(e)},children:Object(m.jsx)("img",{className:"w-12 h-12 rounded-full",src:null===i||void 0===i?void 0:i.avatar,alt:"avatar"})},e.id)}));return Object(m.jsx)("div",{className:"flex space-x-4",children:o})};var H=function(){var e=Object(n.useState)(!1),t=Object(j.a)(e,2),r=t[0],c=t[1],a=Object(u.f)(),s=function(){c((function(e){return!e}))};return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(d.a,{children:Object(m.jsx)(u.c,{children:Object(m.jsx)(u.a,{})})}),Object(m.jsxs)("header",{className:"h-14 w-full flex items-center bg-gray-400/90 sticky top-0 z-10 backdrop-blur-sm pl-4 space-x-4",children:[Object(m.jsx)("button",{onClick:s,className:"w-6 h-6",children:Object(m.jsx)(b.b,{})}),function(){switch(a.pathname){case"/multi-view":return Object(m.jsx)(I,{});default:return Object(m.jsx)("div",{className:"text-xl tracking-wide font-bold",children:"Holo Viewer"})}}()]}),Object(m.jsx)(f,{open:r,toggle:s})]})};var M=function(e){return Object(m.jsxs)(m.Fragment,{children:[Object(m.jsx)(H,{}),Object(m.jsx)("main",{children:e.children})]})},F=r(5),L=r.n(F),V=r(20),D=r.n(V),A=(r(74),r(39)),B=r.n(A);function J(e){var t=L()();return L.a.duration(t.diff(L()(e))).format("HH:mm:ss")}L.a.extend(D.a),L.a.extend(B.a);var U=function(e){var t=e.stream.start_at,r=Object(n.useState)((function(){return J(t)})),c=Object(j.a)(r,2),a=c[0],s=c[1];return Object(n.useEffect)((function(){var e=setInterval((function(){s(J(t))}),1e3);return function(){clearInterval(e)}}),[t]),Object(m.jsx)("span",{className:"absolute bottom-2 right-2 text-white font-bold tracking-wide bg-red-600/90 px-2 py-0 rounded-sm",children:a})};L.a.extend(D.a),L.a.locale("zh-tw");var z=function(e){var t,r=e.stream,n=Object(i.c)((function(e){return e.streamReducer.channel})),c=Object(i.c)((function(e){return e.streamReducer.member})),a=null===(t=n.find((function(e){return e.id===r.channel_id})))||void 0===t?void 0:t.member_id,s=c.find((function(e){return e.id===a}));return Object(m.jsx)("a",{href:"https://www.youtube.com/watch?v=".concat(r.room),target:"_blank",rel:"noreferrer noopener",children:Object(m.jsxs)("div",{className:"w-full shadow bg-white rounded-lg overflow-hidden",children:[Object(m.jsxs)("div",{className:"relative pt-[56.25%]",children:[Object(m.jsx)("img",{className:"absolute top-0 left-0 w-full h-full object-contain",src:r.cover,alt:r.title}),"live"===r.status&&Object(m.jsx)(U,{stream:r})]}),Object(m.jsxs)("div",{className:"flex items-center h-[80px]",children:[Object(m.jsx)("div",{className:"w-[50px] rounded-full overflow-hidden ml-2 mr-4",children:Object(m.jsx)("img",{src:null===s||void 0===s?void 0:s.avatar,alt:"avator"})}),Object(m.jsxs)("div",{className:"flex-1 min-w-0",children:[Object(m.jsx)("p",{className:"text-lg text-left tracking-wide text-i truncate",children:r.title}),Object(m.jsx)("p",{className:"pt-1",children:null===s||void 0===s?void 0:s.name}),"scheduled"===r.status&&function(){var e=L()(r.start_at).format("HH:mm"),t=L()(r.start_at).fromNow();return Object(m.jsxs)("p",{className:"text-sm",children:["\u5c07\u65bc ",t,"\u958b\u59cb (",e,")"]})}()]})]})]},r.id)})};var P=function(){var e=Object(i.b)(),t=Object(i.c)((function(e){return e.streamReducer.liveStream})),r=Object(i.c)((function(e){return e.streamReducer.scheduledStream}));Object(n.useEffect)((function(){e(k()),e(R()),e(T()),e(C())}),[e]);var c=t.map((function(e){return Object(m.jsx)(z,{stream:e},e.id)})),a=r.filter((function(e){return L()(e.start_at).isBefore(L()().add(1,"day"))})).map((function(e){return Object(m.jsx)(z,{stream:e},e.id)}));return Object(m.jsxs)("div",{className:"p-4 min-h-screen bg-gray-100",children:[Object(m.jsxs)("div",{children:[Object(m.jsx)("p",{className:"text-lg font-bold text-green-600 mb-5",children:"\u76f4\u64ad\u4e2d"}),Object(m.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-2",children:0===t.length?"There is no live stream now":c})]}),Object(m.jsxs)("div",{className:"mt-6",children:[Object(m.jsx)("p",{className:"text-lg font-bold text-green-600 mb-5",children:"\u9810\u5b9a\u76f4\u64ad"}),Object(m.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-2",children:0===r.length?"There is no scheduled stream now":a})]})]})};var W=function(e){var t=e.stream,r="https://www.youtube.com/embed/".concat(t.room),n="https://gaming.youtube.com/live_chat?v=".concat(t.room,"&embed_domain=").concat(window.location.hostname);return Object(m.jsxs)("div",{className:"wrapper flex h-full",children:[Object(m.jsx)("div",{className:"w-10/12",children:Object(m.jsx)("iframe",{title:"This is a unique title",src:r,width:"100%",height:"100%",frameBorder:"0",allow:"fullscreen;"})}),Object(m.jsx)("div",{className:"flex-auto",children:Object(m.jsx)("iframe",{title:"chatRoom",src:n,width:"100%",height:"100%",frameBorder:"0"})})]})},X={1:"grid-cols-1 grid-rows-1",2:"grid-cols-2 grid-rows-1",3:"grid-cols-2 grid-rows-2",4:"grid-cols-2 grid-rows-2",5:"grid-cols-3 grid-rows-2",6:"grid-cols-3 grid-rows-2",7:"grid-cols-3 grid-rows-2",8:"grid-cols-3 grid-rows-2",9:"grid-cols-3 grid-rows-2"};var q=function(){var e=Object(i.c)((function(e){return e.multiViewReducer})),t=e.length;return Object(m.jsx)("div",{className:"h-[calc(100vh-56px)] grid grid-flow-row ".concat(X[t]," "),children:function(){if(t>=0)return e.map((function(e){return Object(m.jsx)(W,{stream:e},e.id)}))}()})};var G=function(){return Object(m.jsx)(d.a,{basename:"/holo-viewer",children:Object(m.jsx)(M,{children:Object(m.jsxs)(u.c,{children:[Object(m.jsx)(u.a,{path:"/",exact:!0,component:P}),Object(m.jsx)(u.a,{path:"/multi-view",exact:!0,component:q})]})})})},K=function(e){e&&e instanceof Function&&r.e(3).then(r.bind(null,76)).then((function(t){var r=t.getCLS,n=t.getFID,c=t.getFCP,a=t.getLCP,s=t.getTTFB;r(e),n(e),c(e),a(e),s(e)}))},Q={liveStream:[],scheduledStream:[],channel:[],member:[]},Y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case g:return Object(O.a)(Object(O.a)({},e),{},{liveStream:t.payload});case p:return Object(O.a)(Object(O.a)({},e),{},{scheduledStream:t.payload});case w:return Object(O.a)(Object(O.a)({},e),{},{channel:t.payload});case N:return Object(O.a)(Object(O.a)({},e),{},{member:t.payload});default:return e}},Z=r(26),$=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case y:return[].concat(Object(Z.a)(e),[t.payload]);case _:return Object(Z.a)(e).filter((function(e){return console.log(e.id,t.payload),e.id!==t.payload}));default:return e}},ee=Object(o.b)({streamReducer:Y,multiViewReducer:$}),te=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||o.c,re=Object(o.d)(ee,te(Object(o.a)(l.a)));s.a.render(Object(m.jsx)(i.a,{store:re,children:Object(m.jsx)(c.a.StrictMode,{children:Object(m.jsx)(G,{})})}),document.getElementById("root")),K()}},[[75,1,2]]]);
//# sourceMappingURL=main.51c1bdbb.chunk.js.map